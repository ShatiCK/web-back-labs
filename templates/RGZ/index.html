


{% extends "base.html" %}
{% block lab %}РГЗ{% endblock %}

{% block main %}
<section class="rgz">
  <div class="rgz__top">
    <div>
      <h1 class="rgz__title">РГЗ: Предложение услуг</h1>
      <p class="rgz__muted">Поиск специалистов по параметрам. Найдено: {{ total }}</p>
    </div>

    <div class="rgz__actions">
      {% if user %}
        {% if user.role == "admin" %}
          <a class="btn btn--primary" href="{{ url_for('rgz.admin_users') }}">Админ-панель</a>
        {% else %}
          <a class="btn btn--primary" href="{{ url_for('rgz.profile') }}">Мой профиль</a>
        {% endif %}
        <a class="btn" href="{{ url_for('rgz.logout') }}">Выход</a>
      {% else %}
        <a class="btn btn--primary" href="{{ url_for('rgz.login') }}">Вход</a>
        <a class="btn" href="{{ url_for('rgz.register') }}">Регистрация</a>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <h2 class="card__title">Поиск</h2>

    <form method="get" action="{{ url_for('rgz.index') }}" class="form form--grid">
      <div class="field">
        <label class="label">Имя</label>
        <input class="input" type="text" name="name" value="{{ filters.name }}" placeholder="Напр. Иван" />
      </div>

      <div class="field">
        <label class="label">Вид услуги</label>
        <select class="select" name="service">
          <option value="">Любой</option>
          {% for s in service_types %}
            <option value="{{ s }}" {% if filters.service == s %}selected{% endif %}>{{ s|capitalize }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="field">
        <label class="label">Стаж (от)</label>
        <input class="input" type="number" name="exp_from" value="{{ filters.exp_from }}" min="0" max="60" placeholder="0" />
      </div>

      <div class="field">
        <label class="label">Стаж (до)</label>
        <input class="input" type="number" name="exp_to" value="{{ filters.exp_to }}" min="0" max="60" placeholder="60" />
      </div>

      <div class="field">
        <label class="label">Цена (от)</label>
        <input class="input" type="number" name="price_from" value="{{ filters.price_from }}" min="0" step="1" placeholder="0" />
      </div>

      <div class="field">
        <label class="label">Цена (до)</label>
        <input class="input" type="number" name="price_to" value="{{ filters.price_to }}" min="0" step="1" placeholder="100000" />
      </div>

      <div class="form__footer">
        <button class="btn btn--primary" type="submit">Найти</button>
        <a class="btn" href="{{ url_for('rgz.index') }}">Сбросить</a>
      </div>
    </form>
  </div>

  <div class="grid">
    {% for u in results %}
      <article class="card card--profile">
        <div class="profile__head">
          <div class="avatar">{{ (u.name or "U")[0]|upper }}</div>
          <div>
            <div class="profile__name">{{ u.name }}</div>
            <div class="profile__meta">{{ u.service|capitalize }} • стаж {{ u.experience }} лет</div>
          </div>
          <div class="profile__price">{{ u.price }} ₽</div>
        </div>
        {% if u.about %}
          <p class="profile__about">{{ u.about }}</p>
        {% else %}
          <p class="profile__about rgz__muted">Описание не указано.</p>
        {% endif %}
      </article>
    {% endfor %}

    {% if results|length == 0 %}
      <div class="card">
        <p class="rgz__muted">По заданным условиям ничего не найдено.</p>
      </div>
    {% endif %}
  </div>

  <div class="pager">
    {% if page > 1 %}
      <a class="btn" href="{{ url_for('rgz.index', page=page-1, **filters) }}">Назад</a>
    {% endif %}

    <div class="pager__info">Страница {{ page }}</div>

    {% if has_next %}
      <a class="btn btn--primary" href="{{ url_for('rgz.index', page=page+1, **filters) }}">Следующие</a>
    {% endif %}
  </div>
</section>

<style>
  .rgz { max-width: 980px; margin: 0 auto; }
  .rgz__top { display:flex; gap:16px; align-items:flex-start; justify-content:space-between; margin-bottom:16px; }
  .rgz__title { margin: 0 0 6px 0; font-size: 28px; }
  .rgz__muted { margin: 0; opacity: .75; }
  .rgz__actions { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

  .card { background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:16px; box-shadow: 0 2px 10px rgba(0,0,0,.04); margin: 14px 0; }
  .card__title { margin:0 0 12px 0; font-size:18px; }

  .form--grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
  .field { display:flex; flex-direction:column; gap:6px; }
  .label { font-size: 13px; opacity:.8; }
  .input, .select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff; }
  .input:focus, .select:focus, textarea:focus { outline: none; border-color: rgba(0,0,0,.35); }

  .form__footer { grid-column: 1 / -1; display:flex; gap:10px; justify-content:flex-end; margin-top: 4px; }

  .btn { display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff; text-decoration:none; color:inherit; }
  .btn:hover { border-color: rgba(0,0,0,.25); }
  .btn--primary { background:#111; color:#fff; border-color:#111; }
  .btn--primary:hover { opacity: .92; }

  .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px; }
  .card--profile { margin:0; }
  .profile__head { display:flex; align-items:center; gap:12px; }
  .avatar { width:44px; height:44px; border-radius:12px; background: rgba(0,0,0,.06); display:flex; align-items:center; justify-content:center; font-weight:700; }
  .profile__name { font-weight: 700; }
  .profile__meta { font-size: 13px; opacity:.75; margin-top:2px; }
  .profile__price { margin-left:auto; font-weight:700; white-space:nowrap; }
  .profile__about { margin: 12px 0 0 0; line-height: 1.45; }

  .pager { display:flex; align-items:center; justify-content:space-between; margin-top: 16px; gap: 12px; }
  .pager__info { opacity:.75; }

  @media (max-width: 900px) {
    .form--grid { grid-template-columns: 1fr; }
    .grid { grid-template-columns: 1fr; }
    .rgz__top { flex-direction: column; align-items: stretch; }
    .rgz__actions { justify-content: flex-start; }
  }
</style>
{% endblock %}
